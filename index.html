<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Convertisseur 64×64 → Blocs CSS</title>
<style>
  :root { --size: 8px; }

  body {
    font-family: Arial;
    padding: 20px;
  }

  #preview {
    width: calc(var(--size) * 64);
    height: calc(var(--size) * 64);
    display: grid;
    grid-template-columns: repeat(64, var(--size));
    grid-template-rows: repeat(64, var(--size));
    border: 1px solid #ccc;
    image-rendering: pixelated;
  }

  .tile {
    width: var(--size);
    height: var(--size);
  }

  /* 7 couleurs simples */
  .tile-black { background: #000; }
  .tile-red { background: #ff0000; }
  .tile-dgreen { background: #005000; }
  .tile-lgreen { background: #00ff00; }
  .tile-yellow { background: #ffff00; }
  .tile-blue { background: #0000ff; }
  .tile-brown { background: #7a4a00; }
</style>
</head>
<body>

<h2>Générateur 64×64 → Blocs CSS</h2>

<input type="file" id="file" accept="image/*">
<button id="download" disabled>Télécharger image 64×64</button>

<canvas id="canvas" width="64" height="64" style="display:none"></canvas>

<h3>Aperçu :</h3>
<div id="preview"></div>

<script>
const fileInput = document.getElementById("file");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d", { willReadFrequently: true });
const preview = document.getElementById("preview");
const dlBtn = document.getElementById("download");

const palette = [
  { rgb: [0,0,0], cls: "tile-black" },
  { rgb: [255,0,0], cls: "tile-red" },
  { rgb: [0,80,0], cls: "tile-dgreen" },
  { rgb: [0,255,0], cls: "tile-lgreen" },
  { rgb: [255,255,0], cls: "tile-yellow" },
  { rgb: [0,0,255], cls: "tile-blue" },
  { rgb: [122,74,0], cls: "tile-brown" }
];

function nearestColor(px){
  let best = null, bestDist = Infinity;
  for(const p of palette){
    let d = (px[0]-p.rgb[0])**2 + (px[1]-p.rgb[1])**2 + (px[2]-p.rgb[2])**2;
    if(d < bestDist){
      bestDist = d;
      best = p.cls;
    }
  }
  return best;
}

fileInput.addEventListener("change", e => {
  const file = e.target.files[0];
  if(!file) return;

  const img = new Image();
  img.onload = () => {
    // crop carré centré
    let side = Math.min(img.width, img.height);
    let sx = (img.width - side) / 2;
    let sy = (img.height - side) / 2;

    ctx.imageSmoothingEnabled = false;
    ctx.clearRect(0, 0, 64, 64);
    ctx.drawImage(img, sx, sy, side, side, 0, 0, 64, 64);

    render();
    dlBtn.disabled = false;
  };
  img.src = URL.createObjectURL(file);
});

function render(){
  preview.innerHTML = "";
  const data = ctx.getImageData(0,0,64,64).data;

  for(let y=0; y<64; y++){
    for(let x=0; x<64; x++){
      const i = (y*64+x)*4;
      const px = [data[i], data[i+1], data[i+2]];

      const div = document.createElement("div");
      div.className = "tile " + nearestColor(px);
      preview.appendChild(div);
    }
  }
}

dlBtn.addEventListener("click", () => {
  const a = document.createElement("a");
  a.download = "image_64x64.png";
  a.href = canvas.toDataURL("image/png");
  a.click();
});
</script>

</body>
</html>
